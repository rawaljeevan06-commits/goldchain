<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard | GoldChain</title>

  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

  <div class="topbar">Dashboard ‚Äî GoldChain Investment</div>

  <header class="header">
    <div class="container header-in">
      <a class="brand" href="index.html">
        <img src="images/logo.png" alt="GoldChain Logo">
        <span>GoldChain</span>
      </a>

      <button class="nav-toggle" type="button" aria-label="Menu">‚ò∞</button>

      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="project.html">Our Project</a>
        <a href="legal.html">Legal</a>
        <a href="contact.html">Contact</a>
      </nav>

      <div class="actions">
        <a class="btn btn-ghost" href="payment.html" id="depositBtn">Deposit</a>
        <button class="btn btn-ghost" id="withdrawBtn" type="button">Withdraw</button>
        <button class="btn btn-primary" id="logoutBtn" type="button">Logout</button>
      </div>
    </div>
  </header>

  <section class="section">
    <div class="container">

      <h2 style="margin-bottom:8px;">Welcome üëã</h2>
      <p class="small">Logged in as: <b id="emailEl">Loading...</b></p>

      <div class="dash-cards" style="margin-top:14px;">

        <div class="card">
          <h3>Account</h3>
          <p class="small">Balance: <b>$<span id="balanceEl">0.00</span></b></p>
          <p class="small">Created: <span id="createdEl">‚Äî</span></p>
        </div>

        <div class="card">
          <h3>Payment Status</h3>
          <p class="small" id="payStatusEl">Checking...</p>
          <a class="btn btn-primary full" href="payment.html" style="margin-top:10px;">Pay / Deposit</a>
        </div>

        <div class="card">
          <h3>Plan</h3>
          <p class="small" id="planEl">Loading...</p>
          <a class="btn btn-ghost full" href="index.html#plans" style="margin-top:10px;">View Plans</a>
        </div>

        <!-- ‚úÖ Referral Card -->
        <div class="card">
          <h3>Your Referral</h3>
          <p class="small">Your Referral Code:</p>

          <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <input id="myRefCode" class="input" readonly style="max-width:220px;">
            <button class="btn btn-primary" id="copyRefBtn" type="button">Copy</button>
          </div>

          <p class="small" style="margin-top:10px;">
            Earnings: <b>$<span id="refEarn">0.00</span></b>
          </p>

          <a href="referral.html" class="btn btn-primary" style="margin-top:10px;">Open Referral Center</a>
        </div>

      </div>

      <!-- ‚úÖ OUR SUCCESS -->
      <div class="card" style="margin-top:18px;">
        <h2>Our Success</h2>
        <p class="small" style="opacity:.9;">
          We focus on controlled verification, transparency, and a premium dashboard experience.
        </p>

        <div style="display:flex; gap:18px; flex-wrap:wrap; margin-top:14px;">
          <div class="card" style="flex:1; min-width:180px;">
            <h3>Verified Deposits</h3>
            <p class="big">Secure</p>
            <p class="small">Balance updates only after verification.</p>
          </div>

          <div class="card" style="flex:1; min-width:180px;">
            <h3>Withdrawals</h3>
            <p class="big">Controlled</p>
            <p class="small">Approval flow for accountability.</p>
          </div>

          <div class="card" style="flex:1; min-width:180px;">
            <h3>Referral Rewards</h3>
            <p class="big">Tracked</p>
            <p class="small">Earnings recorded after verified deposits.</p>
          </div>
        </div>
      </div>

      <!-- ‚úÖ TESTIMONIALS -->
      <div class="card" style="margin-top:18px;">
        <h2>Testimonials</h2>
        <p class="small" style="opacity:.9;">What our members say about GoldChain Investment:</p>

        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(230px, 1fr)); gap:14px; margin-top:12px;">
          <div class="card">
            <p class="small" style="line-height:1.8;">
              ‚ÄúThe dashboard is very clear. Deposit verification gives me confidence that everything is tracked properly.‚Äù
            </p>
            <p class="small" style="opacity:.7; margin-top:10px;"><b>‚Äî Member A</b></p>
          </div>

          <div class="card">
            <p class="small" style="line-height:1.8;">
              ‚ÄúI like the referral center because it shows my code and earnings clearly. Copy button is very helpful.‚Äù
            </p>
            <p class="small" style="opacity:.7; margin-top:10px;"><b>‚Äî Member B</b></p>
          </div>

          <div class="card">
            <p class="small" style="line-height:1.8;">
              ‚ÄúPlans are simple to understand and I can see my account status anytime. Looks professional.‚Äù
            </p>
            <p class="small" style="opacity:.7; margin-top:10px;"><b>‚Äî Member C</b></p>
          </div>
        </div>
      </div>

      <!-- ‚úÖ LEGAL & RISK (SHOW DIRECTLY IN DASHBOARD) -->
      <div class="card" style="margin-top:18px;">
        <h2>Legal & Risk Disclosure</h2>
        <p class="small" style="opacity:.9; line-height:1.9;">
          Participation in financial programs involves risk. Any percentages, examples, or calculator results shown on this platform
          are informational only and do not guarantee future outcomes. Use this platform responsibly and only allocate funds you can afford.
        </p>

        <ul class="small" style="margin-top:10px; line-height:1.9;">
          <li><b>No guarantee:</b> outcomes are not guaranteed.</li>
          <li><b>User responsibility:</b> you decide and accept your own risks.</li>
          <li><b>Verification:</b> deposits are verified before balance update.</li>
          <li><b>Withdrawals:</b> processed through review/approval workflow.</li>
        </ul>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
          <a class="btn btn-outline" href="legal.html">Open Full Legal Page</a>
          <a class="btn btn-primary" href="GoldChain-Legal-Risk-Disclosure.pdf" target="_blank" rel="noopener">
            Download PDF
          </a>
        </div>
      </div>

    </div>
  </section>

  <footer class="footer">
    <div class="container footer-in">
      <p class="small">¬©Ô∏è 2026 GoldChain Investment. All rights reserved.</p>
      <div class="social">
        <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
      </div>
    </div>
  </footer>

  <a class="whatsapp-float" href="https://wa.me/9779851406537" target="_blank" aria-label="WhatsApp Chat">
    <i class="fab fa-whatsapp"></i>
  </a>

  <!-- ‚úÖ ONE script only (module). Do NOT load firebase.js separately. -->
  <script type="module">
    import { auth, db } from "./js/firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // ‚úÖ Put your admin UID(s) here (optional)
    const ADMIN_UIDS = [
      // "YOUR_ADMIN_UID_HERE"
    ];

    const emailEl = document.getElementById("emailEl");
    const balanceEl = document.getElementById("balanceEl");
    const createdEl = document.getElementById("createdEl");

    const planEl = document.getElementById("planEl");
    const payStatusEl = document.getElementById("payStatusEl");

    const myRefCodeEl = document.getElementById("myRefCode");
    const refEarnEl = document.getElementById("refEarn");
    const copyRefBtn = document.getElementById("copyRefBtn");

    const withdrawBtn = document.getElementById("withdrawBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    withdrawBtn?.addEventListener("click", () => {
      window.location.href = "withdrawal.html";
    });

    logoutBtn?.addEventListener("click", async () => {
      try { await signOut(auth); } catch (e) {}
      window.location.href = "login.html";
    });

    copyRefBtn?.addEventListener("click", async () => {
      const code = myRefCodeEl?.value || "";
      if (!code) return;
      try {
        await navigator.clipboard.writeText(code);
        alert("‚úÖ Copied referral code!");
      } catch (e) {
        alert("Copy failed. Please copy manually.");
      }
    });

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.replace("login.html");
        return;
      }

      // Admin redirect
      if (ADMIN_UIDS.includes(user.uid)) {
        window.location.replace("admin.html");
        return;
      }

      emailEl.textContent = user.email || user.uid;

      // ‚úÖ Load user profile from Firestore
      try {
        const snap = await getDoc(doc(db, "users", user.uid));
        if (!snap.exists()) {
          planEl.textContent = "No profile found.";
          payStatusEl.textContent = "No profile found.";
          return;
        }

        const data = snap.data();

        // Account
        const bal = Number(data.balance || 0);
        balanceEl.textContent = bal.toFixed(2);

        if (data.createdAt?.toDate) {
          createdEl.textContent = data.createdAt.toDate().toLocaleString();
        } else {
          createdEl.textContent = "‚Äî";
        }

        // Plan
        planEl.textContent = data.plan ? `Selected Plan: $${data.plan}` : "No plan selected";

        // Payment status
        if (data.paymentVerified === true) {
          payStatusEl.innerHTML = `<span style="color:var(--success, #36d399); font-weight:700;">‚úÖ Payment Verified</span>`;
        } else {
          payStatusEl.innerHTML = `<span style="color:var(--warn, #f59e0b); font-weight:700;">Pending / Not Verified</span>`;
        }

        // Referral
        if (myRefCodeEl) myRefCodeEl.value = data.referralCode || "";
        if (refEarnEl) refEarnEl.textContent = Number(data.referralEarnings || 0).toFixed(2);

      } catch (e) {
        console.log("Dashboard load error:", e);
        planEl.textContent = "Error loading profile.";
        payStatusEl.textContent = "Error loading profile.";
      }
    });
  </script>

  <script>
    // mobile menu toggle
    const navToggle = document.querySelector(".nav-toggle");
    const nav = document.querySelector(".nav");
    if (navToggle && nav) navToggle.addEventListener("click", () => nav.classList.toggle("open"));
  </script>

</body>
</html>
