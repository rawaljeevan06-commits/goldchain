<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login | GoldChain Investment</title>

  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Supabase JS (must load BEFORE we create the client) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Supabase config + client -->
  <script>
    const SUPABASE_URL = "https://isyavausunsombknvhsz.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzeWFhdnVzdW5zb21ia252aHN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NDExOTEsImV4cCI6MjA4NTUxNzE5MX0.SrOKP_Xm2Joi9QPStyAYFGmziavkXvpXbgGfG1LtEfA";

    // Create client only if library loaded
    // (If CDN fails, window.sb stays undefined, and our login script will show a message)
    if (window.supabase) {
      window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    }
  </script>
</head>

<body>

  <div class="topbar">Login — Secure. Smart. Simple.</div>

  <header class="header">
    <div class="container header-in">
      <a class="brand" href="index.html">
        <img src="images/logo.png" alt="GoldChain Logo">
        <span>GoldChain</span>
      </a>

      <button class="nav-toggle" type="button" aria-label="Menu">☰</button>

      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="plans.html">Plans</a>
        <a href="about.html">Our Impact</a>
        <a href="faq.html">FAQ</a>
        <a href="contact.html">Contact</a>
      </nav>

      <div class="actions">
        <a class="btn btn-ghost" href="login.html">Login</a>
        <a class="btn btn-primary" href="signup.html">Sign Up</a>
      </div>
    </div>
  </header>

  <section class="section">
    <div class="container" style="max-width:560px;">
      <div class="card">
        <h2>Login</h2>
        <p class="small">Login with the email and password you created.</p>

        <form id="loginForm" class="form-grid">
          <input class="input" id="loginEmail" type="email" placeholder="Email" required>
          <input class="input" id="loginPassword" type="password" placeholder="Password" required>

          <button class="btn btn-primary full" type="submit">Login</button>
          <p id="loginMsg" class="small"></p>

          <p class="small">No account?
            <a href="signup.html" style="color:var(--gold2);font-weight:700;">Create one</a>
          </p>
        </form>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container footer-in">
      <p class="small">©️ 2026 GoldChain Investment. All rights reserved.</p>
      <div class="social">
        <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
      </div>
    </div>
  </footer>

  <a class="whatsapp-float" href="https://wa.me/9779851406537" target="_blank" aria-label="WhatsApp Chat">
    <i class="fab fa-whatsapp"></i>
  </a>

  <!-- ✅ LOGIN LOGIC (must be BEFORE </body>) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("loginForm");
      const msg = document.getElementById("loginMsg");

      // Safety checks (so we never get "nothing happened")
      if (!form || !msg) return;

      if (!window.supabase) {
        msg.textContent = "Supabase library not loaded (CDN failed). Please refresh.";
        msg.style.color = "#ffb3b3";
        console.error("Supabase CDN not loaded");
        return;
      }

      if (!window.sb) {
        msg.textContent = "Supabase client not created. Check URL/KEY script in <head>.";
        msg.style.color = "#ffb3b3";
        console.error("Supabase client missing");
        return;
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        msg.textContent = "Logging in...";
        msg.style.color = "";

        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value;

        try {
          const { error } = await window.sb.auth.signInWithPassword({ email, password });

          if (error) {
            msg.textContent = error.message;
            msg.style.color = "#ffb3b3";
            console.log("SUPABASE ERROR:", error);
            return;
          }

          msg.textContent = "Login successful!";
          msg.style.color = "#ffd66e";

          setTimeout(() => (window.location.href = "index.html"), 600);
        } catch (err) {
          msg.textContent = "Unexpected error. Open console (F12) to see details.";
          msg.style.color = "#ffb3b3";
          console.error("LOGIN CATCH ERROR:", err);
        }
      });
    });
  </script>

  <!-- ✅ KEEP main.js if it handles menu/nav -->
  <script src="js/main.js"></script>

</body>
</html>
